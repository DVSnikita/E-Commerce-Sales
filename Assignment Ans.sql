CREATE DATABASE ORG;
USE ORG;
CREATE TABLE Customers (
CustomerID INT PRIMARY KEY,
Name VARCHAR(255),
Email VARCHAR(255),
JoinDate DATE
);
CREATE TABLE Products (
ProductID INT PRIMARY KEY,
Name VARCHAR(255),
Category VARCHAR(255),
Price DECIMAL(10, 2)
);
CREATE TABLE Orders (
OrderID INT PRIMARY KEY,
CustomerID INT,
OrderDate DATE,
TotalAmount DECIMAL(10, 2),
FOREIGN KEY (CustomerID) REFERENCES Customers(CustomerID)
);

CREATE TABLE OrderDetails (
OrderDetailID INT PRIMARY KEY,
OrderID INT,
ProductID INT,
Quantity INT,
PricePerUnit DECIMAL(10, 2),
FOREIGN KEY (OrderID) REFERENCES Orders(OrderID),
FOREIGN KEY (ProductID) REFERENCES Products(ProductID)
);


INSERT INTO Customers (CustomerID, Name, Email, JoinDate) VALUES
(1, 'John Doe', 'johndoe@example.com', '2020-01-10'),
(2, 'Jane Smith', 'janesmith@example.com', '2020-01-15'),
(3, 'Jim Halpert', 'jimhalpert@example.com', '2020-01-16'),
(4, 'Pam Beasaley', 'pambasley@example.com', '2020-02-1'),
(5, 'Angela Martin', 'angelamartin@example.com', '2020-02-25'),
(6, 'Toby Flenderson', 'tobyflenderson@example.com', '2020-02-14'),
(7, 'John Smith', 'johnsmith@example.com', '2020-03-15'),
(8, 'Kevin Malone', 'kevinmalone@example.com', '2020-04-15'),
(9, 'Stanley Hudson', 'stanleyhudson@example.com', '2020-04-20'),
(10, 'Alice Johnson', 'alicejohnson@example.com', '2020-03-05');

INSERT INTO Products (ProductID, Name, Category, Price) VALUES
(1, 'Laptop', 'Electronics', 999.99),
(2, 'Smartphone', 'Electronics', 499.99),
(3, 'Fan', 'Electronics', 899.99),
(4, 'Mobile', 'Electornics', 599.99),
(5, 'Tablet', 'Electronics', 299.99),
(6, 'Headphones', 'Electronics', 99.99),
(7, 'Television', 'Electronics', 799.99),
(8, 'Coffee Maker', 'Home Appliances', 49.99),
(9, 'Blender', 'Home Appliances', 39.99),
(10, 'Desk Lamp', 'Home Decor', 29.99);


INSERT INTO Orders (OrderID, CustomerID, OrderDate, TotalAmount)
VALUES
(1, 1, '2020-02-15', 1499.98),
(2, 2, '2020-02-17', 499.99),
(3, 3, '2020-02-22', 1299.99),
(4, 4, '2020-02-22', 1299.99),
(5, 5, '2020-02-25', 399.99),
(6, 6, '2020-03-01', 599.99),
(7, 7, '2020-03-05', 149.99),
(8, 8, '2020-03-10', 999.99),
(9, 9, '2020-03-15', 699.99),
(10, 10, '2020-03-21', 78.99);

INSERT INTO OrderDetails (OrderDetailID, OrderID, ProductID, Quantity,PricePerUnit) VALUES
(1, 1, 1, 1, 999.99),
(2, 2, 2, 1, 499.99),
(3, 3, 3, 2, 599.99),
(4, 4, 4, 5, 399.99),
(5, 5, 5, 10, 299.99),
(6, 6, 6, 8, 199.99),
(7, 7, 7, 9, 299.99),
(8, 8, 8, 25, 99.99),
(9, 9, 9, 20, 59.99),
(10, 10, 10, 2, 29.99);


-- 1. Basic Queries--
-- 1.1. List all customers.
select * from Customers;

-- 1.2. Show all products in the 'Electronics' category.
select * from Products where Category = 'Electronics';

-- 1.3. Find the total number of orders placed.
SELECT COUNT(*) AS TotalOrders FROM Orders;

-- 1.4. Display the details of the most recent order.
SELECT * FROM Orders ORDER BY OrderDate DESC LIMIT 1;


-- 2. Joins and Relationships:
-- 2.1. List all products along with the names of the customers who ordered them.

SELECT p.*, c.Name AS CustomerName
FROM Products p
INNER JOIN OrderDetails od ON p.ProductID = od.ProductID
INNER JOIN Orders o ON od.OrderID = o.OrderID
INNER JOIN Customers c ON o.CustomerID = c.CustomerID;


-- 2.2. Show orders that include more than one product.

SELECT o.*
FROM Orders o
INNER JOIN (
    SELECT OrderID, COUNT(*) AS ProductCount
    FROM OrderDetails
    GROUP BY OrderID
    HAVING ProductCount > 1
) od ON o.OrderID = od.OrderID;


-- 2.3. Find the total sales amount for each customer.
SELECT c.CustomerID, c.Name AS CustomerName, SUM(o.TotalAmount) AS TotalSales
FROM Customers c
INNER JOIN Orders o ON c.CustomerID = o.CustomerID
GROUP BY c.CustomerID, c.Name;


-- 3. Aggregation and Grouping:
-- 3.1. Calculate the total revenue generated by each product category.
SELECT p.Category, SUM(od.Quantity * od.PricePerUnit) AS TotalRevenue
FROM Products p
INNER JOIN OrderDetails od ON p.ProductID = od.ProductID
GROUP BY p.Category;

-- 3.2. Determine the average order value.
SELECT AVG(TotalAmount) AS AvgOrderValue FROM Orders;

-- 3.3. Find the month with the highest number of orders.
SELECT MONTH(OrderDate) AS Month, COUNT(*) AS TotalOrders
FROM Orders
GROUP BY MONTH(OrderDate)
ORDER BY TotalOrders DESC
LIMIT 1;

-- 4. Subqueries and Nested Queries:
-- 4.1. Identify customers who have not placed any orders.
SELECT *
FROM Customers
WHERE CustomerID NOT IN (SELECT DISTINCT CustomerID FROM Orders);

-- 4.2. Find products that have never been ordered.
SELECT *
FROM Products
WHERE ProductID NOT IN (SELECT DISTINCT ProductID FROM OrderDetails);

-- 4.3. Show the top 3 best-selling products.
SELECT p.*, SUM(od.Quantity) AS TotalQuantitySold
FROM Products p
INNER JOIN OrderDetails od ON p.ProductID = od.ProductID
GROUP BY p.ProductID
ORDER BY TotalQuantitySold DESC
LIMIT 3;

-- 5. Date and Time Functions:
-- 5.1. List orders placed in the last month.
SELECT * FROM Orders WHERE OrderDate >= DATE_SUB(NOW(), INTERVAL 1 MONTH);

-- 5.2. Determine the oldest customer in terms of membership duration.
SELECT * FROM Customers ORDER BY JoinDate ASC LIMIT 1;

-- 6. Advanced Queries:
-- 6.1. Rank customers based on their total spending.
SELECT c.*, SUM(o.TotalAmount) AS TotalSpending
FROM Customers c
INNER JOIN Orders o ON c.CustomerID = o.CustomerID
GROUP BY c.CustomerID, c.Name
ORDER BY TotalSpending DESC;

-- 6.2. Identify the most popular product category.
SELECT p.Category, SUM(od.Quantity) AS TotalQuantitySold
FROM Products p
INNER JOIN OrderDetails od ON p.ProductID = od.ProductID
GROUP BY p.Category
ORDER BY TotalQuantitySold DESC
LIMIT 1;

-- 6.3. Calculate the month-over-month growth rate in sales.
SELECT 
    DATE_FORMAT(OrderDate, '%Y-%m') AS Month,
    SUM(TotalAmount) AS TotalSales,
    (SUM(TotalAmount) - LAG(SUM(TotalAmount)) OVER (ORDER BY MIN(OrderDate))) / LAG(SUM(TotalAmount)) OVER (ORDER BY MIN(OrderDate)) AS GrowthRate
FROM Orders
GROUP BY DATE_FORMAT(OrderDate, '%Y-%m');

-- 7. Data Manipulation and Updates:
-- 7.1. Add a new customer to the Customers table.
INSERT INTO Customers (CustomerID, Name, Email, JoinDate) VALUES
(11, 'Bob Johnson', 'bobjohnson@example.com', '2022-01-01');

-- 7.2. Update the price of a specific product.
UPDATE Products SET Price = 39.99 WHERE ProductID = 10;













